var _=require("underscore"),EventEmitter=require("events").EventEmitter,util=require("util");module.exports={getSocketProvider:function(a,b,c){var d=function(a){var b=this;EventEmitter.call(b),b.socket=a,Object.defineProperty(b,"id",{get:function(){return b.socket.id},enumerable:!0}),b.socket.on("disconnect",function(){b.emit("disconnect",b)}),_.each(["publish","unsubscribe","subscribe","clientId","migrationComplete"],function(a){b.socket.on("postal."+a,function(c){b.emit(a,c)})})};util.inherits(d,EventEmitter),d.prototype.publish=function(a,b){this.socket.emit("postal.socket.remote",b)},d.prototype.confirmClientIdentified=function(a){this.socket.emit("postal.socket.identified",{uid:a})},d.prototype.migrateClientSubscriptions=function(){this.socket.emit("postal.socket.migration",{})};var e=function(a,b){var b=b||{},c=require("socket.io").listen(a),e=this;c.set("log level",b.ioLogLevel||1),EventEmitter.call(e),e.events={connect:[]},c.sockets.on("connection",function(a){var b=new d(a);e.emit("connect",b)})};return util.inherits(e,EventEmitter),new e(b,c)}}